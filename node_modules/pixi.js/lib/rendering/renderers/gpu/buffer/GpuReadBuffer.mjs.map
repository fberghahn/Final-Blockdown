{"version":3,"file":"GpuReadBuffer.mjs","sources":["../../../../../src/rendering/renderers/gpu/buffer/GpuReadBuffer.ts"],"sourcesContent":["import { Buffer } from '../../shared/buffer/Buffer';\nimport { BufferUsage } from '../../shared/buffer/const';\n\nimport type { WebGPURenderer } from '../WebGPURenderer';\n\nexport function GpuReadBuffer(buffer: Buffer, renderer: WebGPURenderer)\n{\n    const bufferSize = buffer.descriptor.size;\n\n    const device = renderer.gpu.device;\n\n    const stagingBuffer = new Buffer({\n        data: new Float32Array(2400000),\n        usage: BufferUsage.MAP_READ | BufferUsage.COPY_DST,\n    });\n\n    const stagingGPUBuffer = renderer.buffer.createGPUBuffer(stagingBuffer);\n\n    const commandEncoder = device.createCommandEncoder();\n\n    commandEncoder.copyBufferToBuffer(\n        renderer.buffer.getGPUBuffer(buffer),\n        0, // Source offset\n        stagingGPUBuffer,\n        0, // Destination offset\n        bufferSize,\n    );\n\n    device.queue.submit([commandEncoder.finish()]);\n\n    void stagingGPUBuffer.mapAsync(\n        GPUMapMode.READ,\n        0, // Offset\n        bufferSize, // Length\n    ).then(() =>\n    {\n        stagingGPUBuffer.getMappedRange(0, bufferSize);\n        stagingGPUBuffer.unmap();\n    });\n}\n"],"names":[],"mappings":";;;;AAKgB,SAAA,aAAA,CAAc,QAAgB,QAC9C,EAAA;AACI,EAAM,MAAA,UAAA,GAAa,OAAO,UAAW,CAAA,IAAA,CAAA;AAErC,EAAM,MAAA,MAAA,GAAS,SAAS,GAAI,CAAA,MAAA,CAAA;AAE5B,EAAM,MAAA,aAAA,GAAgB,IAAI,MAAO,CAAA;AAAA,IAC7B,IAAA,EAAM,IAAI,YAAA,CAAa,IAAO,CAAA;AAAA,IAC9B,KAAA,EAAO,WAAY,CAAA,QAAA,GAAW,WAAY,CAAA,QAAA;AAAA,GAC7C,CAAA,CAAA;AAED,EAAA,MAAM,gBAAmB,GAAA,QAAA,CAAS,MAAO,CAAA,eAAA,CAAgB,aAAa,CAAA,CAAA;AAEtE,EAAM,MAAA,cAAA,GAAiB,OAAO,oBAAqB,EAAA,CAAA;AAEnD,EAAe,cAAA,CAAA,kBAAA;AAAA,IACX,QAAA,CAAS,MAAO,CAAA,YAAA,CAAa,MAAM,CAAA;AAAA,IACnC,CAAA;AAAA;AAAA,IACA,gBAAA;AAAA,IACA,CAAA;AAAA;AAAA,IACA,UAAA;AAAA,GACJ,CAAA;AAEA,EAAA,MAAA,CAAO,MAAM,MAAO,CAAA,CAAC,cAAe,CAAA,MAAA,EAAQ,CAAC,CAAA,CAAA;AAE7C,EAAA,KAAK,gBAAiB,CAAA,QAAA;AAAA,IAClB,UAAW,CAAA,IAAA;AAAA,IACX,CAAA;AAAA;AAAA,IACA,UAAA;AAAA;AAAA,GACJ,CAAE,KAAK,MACP;AACI,IAAiB,gBAAA,CAAA,cAAA,CAAe,GAAG,UAAU,CAAA,CAAA;AAC7C,IAAA,gBAAA,CAAiB,KAAM,EAAA,CAAA;AAAA,GAC1B,CAAA,CAAA;AACL;;;;"}